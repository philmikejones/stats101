{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Comparing three or more means"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import math\n",
    "import scipy.stats\n",
    "\n",
    "age_shf = pd.read_pickle(\"../data/processed/age_shf\")\n",
    "age_ebn = pd.read_pickle(\"../data/processed/age_ebn\")\n",
    "age_oxf = pd.read_pickle(\"../data/processed/age_oxf\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In the previous section we compared the means of two different groups to see if they were statistically significantly different.\n",
    "Specifically we tested to see if the mean age of residents of Eastbourne is greater than the mean age of residents of Sheffield, and it was.\n",
    "This suggests that, overall, the population of Eastbourne is older than the population of Sheffield, and so there might be some truth to the caricature that Eastbourne is a popular retirement destination.\n",
    "\n",
    "But what if we want to compare the means of more than two groups?\n",
    "Could we perform multiple $t$--tests?\n",
    "Well, no.\n",
    "It has been argued that the process of performing multiple $t$--tests is laborious because you need to perform one for each pair of means.\n",
    "These days, with the automation provided by computers, we no longer need to do the tests manually so this is no longer relevant; performing multiple $t$--tests in a loop is now a trivial task with `R` or `Python`.\n",
    "\n",
    "But, there's a more important reason we shouldn't perform multiple $t$--tests, even though we can.\n",
    "By performing multiple $t$--tests we increase the risk of making a [Type I error](08-hypothesis-testing.html#Errors-interpreting-the-results).\n",
    "Remember we can never *prove* things with statistics, only calculate how likely something is to happen by chance alone.\n",
    "\n",
    "By convention we use a threshold of 0.05, or less than a 5% chance that the results we observe are by chance.\n",
    "But at 5% there's a 1 in 20 chance we commit a Type I error.\n",
    "So if we performed 20 pairs of $t$--tests we would be almost guaranteed to make at least one Type I error!\n",
    "XKCD, as always, neatly sums this up.\n",
    "\n",
    "![Significant](https://imgs.xkcd.com/comics/significant.png)\n",
    "\n",
    "So instead of making multiple $t$--tests we perform an analysis of variance (ANOVA).\n",
    "\n",
    "## Example\n",
    "\n",
    "For this example I use the ages of a sample of 1,000 people from Sheffield and Eastbourne as before, but to compare an additional mean I include a sample of 1,000 people from Oxford.\n",
    "Oxford is one of the youngest populations overall for any city in the UK, perhaps because of the student population, so this test will see if there is a difference between the ages of Oxford, Sheffield, and Eastbourne.\n",
    "Our null hypothesis ($H_0$) is therefore that there is no statistically significant difference between the mean ages of residents in Oxford, Sheffield, and Eastbourne.\n",
    "\n",
    "## Assumptions\n",
    "\n",
    "The assumptions of ANOVA are, not surprisingly, very similar to those of a $t$--test:\n",
    "\n",
    "- Measurements/observations are independent of each other (i.e. from different people)\n",
    "- Measurements are on a continuous scale\n",
    "- If the sample size is small the variables should have a normal distribution.\n",
    "\n",
    "For our example the observations are independent (the ages of people in Sheffield do not affect the ages of people in Eastbourne or Oxford).\n",
    "Age is a continuous measure (even though it's measured here on a discrete scale we can treat it as continuous).\n",
    "We have sample sizes of 1,000 per group so do not need to check for normality, but if we did we would plot a series of [QQ plots](11-comparing-two-independent-groups.html#Assumptions) as we did for $t$--tests.\n",
    "\n",
    "## Equality of variance\n",
    "\n",
    "As with the $t$--test we need to first test to see if the variances of the groups are equal, as this affects how we interpret the ANOVA.\n",
    "We again use a Levene test for equality of variance."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "scipy.stats.levene(\n",
    "    age_oxf.C_AGE_NAME, age_shf.C_AGE_NAME, age_ebn.C_AGE_NAME\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Here the Levene statistic is statistically significant ($p << 0.01$) so we must reject the null that there is no difference between the variances, and assume that the variances are not equal.\n",
    "\n",
    "## ANOVA\n",
    "\n",
    "As we do not have groups with equal variance, we need to specify a "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "scipy.stats.f_oneway(\n",
    "    age_shf, age_ebn, age_oxf\n",
    ")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
